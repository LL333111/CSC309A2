datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

generator client {
  provider = "prisma-client-js"
}

enum RoleType {
  regular
  cashier
  manager
  superuser
}

enum TransactionType {
  purchase
  redemption
  adjustment
  event
  transfer
}

enum PromotionType {
  automatic
  onetime
}

model User {
  id         Int         @id @default(autoincrement())
  utorid     String      @unique
  name       String
  email      String      @unique
  birthday   String?
  role       RoleType    @default(regular)
  points     Int         @default(0)
  createdAt  String
  lastLogin  String?
  verified   Boolean     @default(false)
  avatarUrl  String? // 头像
  password   String?
  promotions Promotion[]
  suspicious Boolean     @default(false) // 是否被标记为suspicious
  resetToken String? // reset token
  expiresAt  String? // reset token expires At

  guestsEvent     Event[] @relation("EventOrganizers")
  organizersEvent Event[] @relation("EventGuests")
}

model Event {
  id            Int     @id @default(autoincrement())
  name          String
  description   String
  location      String
  startTime     String
  endTime       String
  pointsRemain  Int
  pointsAwarded Int     @default(0)
  published     Boolean @default(false)

  capacity   Int? // 限制参与人数 无限制为 null
  organizers User[] @relation("EventOrganizers")
  guests     User[] @relation("EventGuests")
  numGuests  Int    @default(0) // 当前参与人数
}

model Promotion {
  id          Int    @id @default(autoincrement())
  name        String
  description String
  type        String
  startTime   String
  endTime     String
  minSpending Float? @default(50)
  rate        Float? @default(0.01)
  points      Int?   @default(0)
  users       User[]
}
